# SMB
## SMBCLIENT
```
smbclient -L=192.168.1.12
```
## Scanning for the NetBIOS Service
```
nmap -v -p 139,445 10.11.1.115 -oG /tmp/smb.txt
```
## Nmap script scan
```
nmap --script smb-vuln* -p 139,445 10.11.1.115
```
```
nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.136.224
```
## List and view permission
```
smbmap -H 10.11.1.24 -r
```
## List all files under a directory recursively
```
smbmap -R "Bob share" -H 10.11.1.136
```
## Check permission of a user
```
smbmap -H 10.10.10.100 -d active.htb -u SVC_TGS -p GPPstillStandingStrong2k18
```
## List shares and view comments
```
smbclient -L
```
## Find and auto download a file using smbmap
```
smbmap -R Users -H 10.10.10.10.100 -A Groups.xml -q
```
## Download files recursively using smbget
```
smbget -R smb://10.10.136.224/anonymous
```
## Download files recursively using smbclient
```
PROMPT OFF
RECURSE ON
mget *
```
> Unpatched versions of Samba from 3.5.0 to 4.4.13, and versions prior to 4.5.10 and 4.6.4 are affected by a vulnerability that allows remote code execution
```
nmap --script smb-vuln-cve-2017-7494 --script-args smb-vuln-cve-2017-7494.check-version -p445 <target>
```
## Mount smb share to our machine 
```
mount -t cifs -o username=finance //10.10.10.59/ACCT /mnt/smb
mount -t cifs -o port=4455 //10.11.0.22/Data -o username=Administrator,password=Qwerty09! /mnt/win10_share 
mount -t cifs "//$IP/files" /mnt/smb
```
## Login to share ipc$ as user john
```
smbclient //192.168.1.105/ipc$ -U john 
```
## smb to shell
```
./psexec.py active.htb/administrator@10.10.10.10
```
## Null Session Enumeration
```
enum4linux -a 192.168.1.12
```
## Null Sessions
> A null session is a connection with a samba or SMB server that does not require authentication with a password. Null sessions were enabled by default on legacy systems but have been disabled from Windows XP SP2 and Windows Server 2003.Â 
```ShellSession
root@kali:~#    smbclient \\\\192.168.1.12 \\public
Enter root's password:
Anonymous login successful
```
## Null session using rpcclient
```ShellSession
root@kali:~#    rpcclient -U "" [target IP address]
rpcclient $> querydominfo
rpcclient $> enumdomusers //The result is a list of user accounts available on the system with the RID in hexadecimal form (0x3E8 = 1000)
rpcclient $> queryuser [username]
```
## SMB OS Discovery
```
nmap $ip --script smb-os-discovery.ns
```
## Netbios Information Scanning
```
nbtscan -r $ip/24
```
## Nmap find exposed Netbios servers
```
nmap -sU --script nbstat.nse -p 137 $ip
```



