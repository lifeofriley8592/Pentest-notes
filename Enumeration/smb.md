# SMB Enumeration
-  SMBCLIENT
```
smbclient -L=192.168.1.12
```
-  Nmap script scan
```
nmap --script smb-vuln* -p 139,445 10.11.1.115
```
> Unpatched versions of Samba from 3.5.0 to 4.4.13, and versions prior to 4.5.10 and 4.6.4 are affected by a vulnerability that allows remote code execution
```
nmap --script smb-vuln-cve-2017-7494 --script-args smb-vuln-cve-2017-7494.check-version -p445 <target>
```
```
nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse 10.10.136.224
```
- List and view permission
```
smbmap -H 10.11.1.24 -r
```
- List all files under a directory recursively
```
smbmap -R "Bob share" -H 10.11.1.136
```
- Check permission of a user
```
smbmap -H 10.10.10.100 -d active.htb -u SVC_TGS -p GPPstillStandingStrong2k18
```
- List shares and view comments
```
smbclient -L
```
- Find and auto download a file using smbmap
```
smbmap -R Users -H 10.10.10.10.100 -A Groups.xml -q
```
- Download files recursively using smbget
```
smbget -R smb://10.10.136.224/anonymous
```
- Download files recursively using smbclient
```
PROMPT OFF
RECURSE ON
mget *
```
- Mount smb share to our machine 
```
mount -t cifs -o username=finance //10.10.10.59/ACCT /mnt/smb
mount -t cifs -o port=4455 //10.11.0.22/Data -o username=Administrator,password=Qwerty09! /mnt/win10_share 
mount -t cifs "//$IP/files" /mnt/smb
```
- Login to share ipc$ as user john
```
smbclient //192.168.1.105/ipc$ -U john 
```
- smb to shell
```
./psexec.py active.htb/administrator@10.10.10.10
```
- Null Session Enumeration
```
enum4linux -a 192.168.1.12
```
- Null Sessions
> A null session is a connection with a samba or SMB server that does not require authentication with a password. Null sessions were enabled by default on legacy systems but have been disabled from Windows XP SP2 and Windows Server 2003.

```
enum4linux
```
```
root@kali:~#    smbclient \\\\192.168.1.12 \\public
Enter root's password:
Anonymous login successful
```
- Null session using rpcclient
```
root@kali:~#    rpcclient -U "" [target IP address]
rpcclient $> querydominfo
rpcclient $> enumdomusers //The result is a list of user accounts available on the system with the RID in hexadecimal form (0x3E8 = 1000)
rpcclient $> queryuser [username]
```
- SMB OS Discovery
```
nmap $ip --script smb-os-discovery.ns
```
- Netbios Information Scanning
```
nbtscan -r $ip/24
```
- Nmap find exposed Netbios servers
```
nmap -sU --script nbstat.nse -p 137 $ip
```
- MS09-050
> This module exploits an out of bounds function table dereference in the SMB request validation code of the SRV2.SYS driver included with Windows Vista, Windows 7 release candidates (not RTM), and Windows 2008 Server prior to R2. Windows Vista without SP1 does not seem affected by this flaw.
- MS17-010
Targets : `Windows 7/8/8.1 and Windows Server 2003/2008/2012(R2)/2016`
```
nmap -p 445 10.11.1.128 --script=smb-vuln-ms17-010
```
https://github.com/helviojunior/MS17-010
- MS08-067
Targets : `Windows XP and Windows server 2003`
```
nmap -p 139,445 --script=smb-vuln-ms08-067 [target ip]
```
https://raw.githubusercontent.com/jivoi/pentest/master/exploit_win/ms08-067.py
- CVE-2017-7494
> Unpatched versions of Samba from 3.5.0 to 4.4.13, and versions prior to
4.5.10 and 4.6.4 are affected by a vulnerability that allows remote code
execution
```
nmap --script smb-vuln-cve-2017-7494 --script-args smb-vuln-cve-2017-7494.check-version -p 139,445 10.11.1.231
```